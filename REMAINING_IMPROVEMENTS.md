# –ß—Ç–æ –µ—â–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è 100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —ç—Ç–∞–ª–æ–Ω—É

**–î–∞—Ç–∞:** 2025-10-06
**–≠—Ç–∞–ª–æ–Ω–Ω—ã–π —Ñ–∞–π–ª:** `/home/elcrypto/calk_wk/check_wr_final.py`
**–¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª:** `/home/elcrypto/trading_assistant/database.py::process_scoring_signals_batch()`

---

## ‚úÖ –£–ñ–ï –ò–°–ü–†–ê–í–õ–ï–ù–û (–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã):

| ‚Ññ | –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–∏—Ç |
|---|----------|--------|--------|
| 1 | –¢–∞–π–º—Ñ—Ä–µ–π–º 15m ‚Üí 5m | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `62dba9c` |
| 2 | 3-—Ñ–∞–∑–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (Phase 1/2/3) | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `62dba9c` |
| 3 | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `85c581e` |
| 4 | –£—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π (NET PnL) | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `02a2f71` |

**–í–ª–∏—è–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- Win Rate: —É–ª—É—á—à–µ–Ω –Ω–∞ 20-35% (–±—ã–ª–æ: 70-90%, —Å—Ç–∞–ª–æ: 50-55%)
- PnL: —Ç–æ—á–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞ –≤ 3-5 —Ä–∞–∑ (–±—ã–ª–æ: –∑–∞–≤—ã—à–µ–Ω –≤ 5-10x, —Å—Ç–∞–ª–æ: –∑–∞–≤—ã—à–µ–Ω –≤ 1.5-2x)

---

## ‚ùå –û–°–¢–ê–ï–¢–°–Ø –ù–ï –ò–°–ü–†–ê–í–õ–ï–ù–û:

–î–ª—è **100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è** —ç—Ç–∞–ª–æ–Ω—É —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

---

### 1. üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–æ–º (Capital Management)

**–°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ç—á–µ—Ç:** SCORING_AUDIT_REPORT.md, —Å—Ç—Ä–æ–∫–∏ 107-167
**–û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:** üî¥ –í—ã—Å–æ–∫–∞—è (~150-200 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞)

#### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è:

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
initial_capital = 1000.0  # –ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª
available_capital = initial_capital
min_equity = initial_capital
max_concurrent_positions = 0
total_pnl = 0.0
total_commission_paid = 0.0
```

**–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞
if available_capital < position_size:
    print(f"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–∞–ø–∏—Ç–∞–ª–∞: {available_capital} < {position_size}")
    continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∏–≥–Ω–∞–ª

# –†–µ–∑–µ—Ä–≤–∏—Ä—É–µ–º –º–∞—Ä–∂—É
available_capital -= position_size
open_positions[pair_symbol] = {
    'signal_id': signal_id,
    'entry_price': entry_price,
    'position_size': position_size,
    'open_time': signal_time,
    ...
}
max_concurrent_positions = max(max_concurrent_positions, len(open_positions))
```

**–ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏:**
```python
# –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –º–∞—Ä–∂—É
available_capital += position_size

# –£—á–∏—Ç—ã–≤–∞–µ–º PnL
total_pnl += net_pnl
total_commission_paid += commission_usd

# –£–¥–∞–ª—è–µ–º –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö
del open_positions[pair_symbol]
```

**–†–∞—Å—á–µ—Ç min_equity –Ω–∞ –∫–∞–∂–¥–æ–π –≤–æ–ª–Ω–µ:**
```python
# Floating PnL –¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
floating_pnl = 0.0
for pair, position in open_positions.items():
    current_price = get_current_price(pair, wave_time)
    unrealized_pnl = calculate_unrealized_pnl(position, current_price)
    floating_pnl += unrealized_pnl

# –¢–µ–∫—É—â–∏–π equity
current_equity = available_capital + floating_pnl + len(open_positions) * position_size
min_equity = min(min_equity, current_equity)
```

**–§–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
```python
final_equity = available_capital + total_pnl
max_drawdown = ((initial_capital - min_equity) / initial_capital) * 100
```

#### –í–ª–∏—è–Ω–∏–µ:
- ‚úÖ –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ –£—á–µ—Ç –ø—Ä–æ—Å–∞–¥–∫–∏ (drawdown)
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç—å –±–æ–ª—å—à–µ –ø–æ–∑–∏—Ü–∏–π, —á–µ–º –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–∞–ø–∏—Ç–∞–ª

---

### 2. üåä –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–æ–ª–Ω–∞–º (Wave-based Processing)

**–°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ç—á–µ—Ç:** SCORING_AUDIT_REPORT.md, —Å—Ç—Ä–æ–∫–∏ 170-239
**–û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:** üü° –°—Ä–µ–¥–Ω—è—è (~100-150 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞)

#### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è:

**–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –ø–æ 15-–º–∏–Ω—É—Ç–Ω—ã–º –≤–æ–ª–Ω–∞–º:**
```python
from collections import defaultdict

signals_by_wave = defaultdict(list)
for signal in all_signals:
    ts = signal['timestamp']
    # –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ 15-–º–∏–Ω—É—Ç–Ω–æ–π –≥—Ä–∞–Ω–∏—Ü—ã
    wave_key = ts.replace(minute=(ts.minute // 15) * 15, second=0, microsecond=0)
    signals_by_wave[wave_key].append(signal)
```

**–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –≤–Ω—É—Ç—Ä–∏ –≤–æ–ª–Ω—ã:**
```python
# –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ score_week (–ª—É—á—à–∏–µ –ø–µ—Ä–≤—ã–º–∏)
for wave_key in signals_by_wave:
    signals_by_wave[wave_key].sort(key=lambda x: x['score_week'], reverse=True)
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ª–Ω –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:**
```python
for wave_time in sorted(signals_by_wave.keys()):
    # 1. –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞–∫—Ä—ã—Ç—å—Å—è –∫ —ç—Ç–æ–º—É –≤—Ä–µ–º–µ–Ω–∏
    closed_pairs = []
    for pair, position in open_positions.items():
        if position['close_time'] <= wave_time:
            # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
            close_position(pair, position, wave_time)
            closed_pairs.append(pair)

    for pair in closed_pairs:
        del open_positions[pair]

    # 2. –û–±–Ω–æ–≤–ª—è–µ–º min_equity —Å —É—á–µ—Ç–æ–º floating PnL
    update_min_equity(open_positions, wave_time)

    # 3. –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ —Ç–µ–∫—É—â–µ–π –≤–æ–ª–Ω—ã
    wave_candidates = signals_by_wave[wave_time]
    trades_taken_this_wave = 0

    for signal in wave_candidates:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –Ω–∞ –≤–æ–ª–Ω—É
        if trades_taken_this_wave >= max_trades_per_15min:
            break

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–ø–∏—Ç–∞–ª–∞
        if available_capital < position_size:
            break

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ –ø–∞—Ä–µ
        if signal['pair_symbol'] in open_positions:
            continue

        # –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
        open_position(signal)
        trades_taken_this_wave += 1
```

#### –í–ª–∏—è–Ω–∏–µ:
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ª—É—á—à–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ (–≤—ã—Å–æ–∫–∏–π score)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–¥–µ–ª–æ–∫ –Ω–∞ –≤–æ–ª–Ω—É
- ‚úÖ –ë–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫

---

### 3. üìç –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π (Position Tracking)

**–°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ç—á–µ—Ç:** SCORING_AUDIT_REPORT.md, —Å—Ç—Ä–æ–∫–∏ 240-293
**–û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:** üü° –°—Ä–µ–¥–Ω—è—è (~100-150 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞)

#### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è:

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π:**
```python
open_positions = {}  # key = pair_symbol, value = position_info

position_info = {
    'signal_id': signal['signal_id'],
    'pair_symbol': signal['pair_symbol'],
    'entry_price': entry_price,
    'entry_time': signal['timestamp'],
    'close_time': None,  # –ë—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∏ —Å–∏–º—É–ª—è—Ü–∏–∏
    'close_price': None,
    'close_reason': None,
    'position_size': position_size,
    'leverage': leverage,
    'signal_action': signal['signal_action'],
    ...
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:**
```python
# –ü–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏
if signal['pair_symbol'] in open_positions:
    print(f"[DUPLICATE] –£–∂–µ –µ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç–∞—è –ø–æ–∑–∏—Ü–∏—è –ø–æ {signal['pair_symbol']}")
    continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∏–≥–Ω–∞–ª
```

**–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π –º–µ–∂–¥—É –≤–æ–ª–Ω–∞–º–∏:**
```python
def close_positions_before_wave(open_positions, wave_time, market_data):
    """–ó–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö close_time <= wave_time"""
    closed_pairs = []

    for pair, position in open_positions.items():
        if position['close_time'] and position['close_time'] <= wave_time:
            # –ü–æ–ª—É—á–∞–µ–º —Ç–æ—á–Ω—É—é —Ü–µ–Ω—É –∑–∞–∫—Ä—ã—Ç–∏—è –∏–∑ —Å–∏–º—É–ª—è—Ü–∏–∏
            close_position(position, market_data)
            closed_pairs.append(pair)

    return closed_pairs
```

**–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –≤ –∫–æ–Ω—Ü–µ –ø–µ—Ä–∏–æ–¥–∞:**
```python
# –í –∫–æ–Ω—Ü–µ —Å–∏–º—É–ª—è—Ü–∏–∏
simulation_end_time = start_date + timedelta(days=period_days)

for pair, position in open_positions.items():
    if not position['close_time']:
        # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ü–µ–Ω–µ
        last_price = get_last_price(pair, simulation_end_time)
        position['close_time'] = simulation_end_time
        position['close_price'] = last_price
        position['close_reason'] = 'period_end'
```

#### –í–ª–∏—è–Ω–∏–µ:
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –¥–≤–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ –æ–¥–Ω–æ–π –ø–∞—Ä–µ
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ –í—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç—ã –≤ –∫–æ–Ω—Ü–µ –ø–µ—Ä–∏–æ–¥–∞

---

### 4. üìà –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (Additional Metrics)

**–°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ç—á–µ—Ç:** SCORING_AUDIT_REPORT.md, —Å—Ç—Ä–æ–∫–∏ 513-516
**–û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:** üü¢ –ù–∏–∑–∫–∞—è (~30-50 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞)

#### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è:

**–ú–µ—Ç—Ä–∏–∫–∏ –≤ –∏—Ç–æ–≥–æ–≤–æ–º –æ—Ç—á–µ—Ç–µ:**
```python
summary_metrics = {
    'initial_capital': 1000.0,
    'final_equity': available_capital + total_pnl,
    'total_pnl': total_pnl,
    'total_pnl_percent': (total_pnl / initial_capital) * 100,
    'max_concurrent_positions': max_concurrent_positions,
    'min_equity': min_equity,
    'max_drawdown_usd': initial_capital - min_equity,
    'max_drawdown_percent': ((initial_capital - min_equity) / initial_capital) * 100,
    'total_commission_paid': total_commission_paid,
    'total_trades': len(all_trades),
    'win_rate': (wins / total_trades) * 100 if total_trades > 0 else 0,
}
```

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î:**
–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é:
```sql
CREATE TABLE web.scoring_session_summary (
    session_id TEXT,
    user_id INTEGER,
    initial_capital NUMERIC,
    final_equity NUMERIC,
    total_pnl NUMERIC,
    max_concurrent_positions INTEGER,
    min_equity NUMERIC,
    max_drawdown_percent NUMERIC,
    total_commission_paid NUMERIC,
    ...
);
```

#### –í–ª–∏—è–Ω–∏–µ:
- ‚úÖ –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–∏–º—É–ª—è—Ü–∏–∏
- ‚úÖ –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∏—Å–∫–æ–≤ (drawdown)
- ‚úÖ –í–∏–¥–∏–º–æ—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–ø–∏—Ç–∞–ª–æ–º

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê –†–ê–ë–û–¢:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | –í—Ä–µ–º—è |
|-----------|-----------|------------|-------|
| 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–æ–º | üî¥ –í—ã—Å–æ–∫–∞—è | 150-200 | 3-4 —á–∞—Å–∞ |
| 2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–æ–ª–Ω–∞–º | üü° –°—Ä–µ–¥–Ω—è—è | 100-150 | 2-3 —á–∞—Å–∞ |
| 3. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π | üü° –°—Ä–µ–¥–Ω—è—è | 100-150 | 2-3 —á–∞—Å–∞ |
| 4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ | üü¢ –ù–∏–∑–∫–∞—è | 30-50 | 0.5-1 —á–∞—Å |
| **–ò–¢–û–ì–û** | | **380-550** | **8-11 —á–∞—Å–æ–≤** |

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø:

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
```python
def process_scoring_signals_batch(signals):
    for signal in signals:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
        result = process_single_signal(signal)
        save_to_db(result)
```

### –¢—Ä–µ–±—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
```python
def process_scoring_signals_batch_v2(signals):
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏–º—É–ª—è—Ü–∏–∏
    sim = TradingSimulation(
        initial_capital=1000,
        position_size=200,
        leverage=10
    )

    # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –≤–æ–ª–Ω–∞–º
    signals_by_wave = group_signals_by_wave(signals)

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ª–Ω –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
    for wave_time in sorted(signals_by_wave.keys()):
        # –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π
        sim.close_due_positions(wave_time)

        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
        sim.update_equity_metrics(wave_time)

        # –û—Ç–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π
        sim.process_wave_signals(signals_by_wave[wave_time])

    # –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
    sim.close_all_positions()
    return sim.get_summary()
```

---

## ‚ö†Ô∏è –†–ò–°–ö–ò –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:

### –†–∏—Å–∫–∏:
1. üî¥ **–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫** - –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
2. üü° **–†–µ–≥—Ä–µ—Å—Å–∏—è** - –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
3. üü° **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î
4. üü¢ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –Ω—É–∂–Ω—ã –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é** `process_scoring_signals_batch_v2()` –≤–º–µ—Å—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ä–æ–π
2. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** - –¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤—ã–±–æ—Ä –º–µ–∂–¥—É v1 –∏ v2
3. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –∑–∞–ø—É—Å–∫–∞—Ç—å –æ–±–µ –≤–µ—Ä—Å–∏–∏ –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
4. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞—Ç—å —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏

---

## ‚úÖ –ü–†–ò–û–†–ò–¢–ï–¢–´:

### üî¥ –ö–†–ò–¢–ò–ß–ù–û (—É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):
- ‚úÖ –¢–∞–π–º—Ñ—Ä–µ–π–º 5m
- ‚úÖ 3-—Ñ–∞–∑–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
- ‚úÖ –£—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π

### üü° –í–ê–ñ–ù–û (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å):
- ‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–æ–º
- ‚ùå –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–æ–ª–Ω–∞–º
- ‚ùå –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### –í—ã–≤–æ–¥:
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!** –û—Å—Ç–∞–≤—à–∏–µ—Å—è —É–ª—É—á—à–µ–Ω–∏—è –≤–∞–∂–Ω—ã –¥–ª—è 100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è, –Ω–æ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –∫—Ä–∏—Ç–∏—á–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏. –¢–µ–∫—É—â–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å: ~75-80% –æ—Ç —ç—Ç–∞–ª–æ–Ω–∞ (–±—ã–ª–æ: ~20-30%).

---

## üìã –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò:

–ï—Å–ª–∏ –ø—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –¥–æ–≤–µ—Å—Ç–∏ –¥–æ 100%:

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1-2 —á–∞—Å–∞)
- [ ] –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É `feature/wave-based-scoring`
- [ ] –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é `process_scoring_signals_batch_v2()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å feature flag –≤ Config: `USE_WAVE_BASED_SCORING = False`

### –≠—Ç–∞–ø 2: Capital Management (3-4 —á–∞—Å–∞)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å `TradingSimulation`
- [ ] –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–æ–º
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç min_equity

### –≠—Ç–∞–ø 3: Wave Processing (2-3 —á–∞—Å–∞)
- [ ] –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –ø–æ –≤–æ–ª–Ω–∞–º
- [ ] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ score –≤–Ω—É—Ç—Ä–∏ –≤–æ–ª–Ω
- [ ] –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ª–Ω

### –≠—Ç–∞–ø 4: Position Tracking (2-3 —á–∞—Å–∞)
- [ ] –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- [ ] –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π –º–µ–∂–¥—É –≤–æ–ª–Ω–∞–º–∏

### –≠—Ç–∞–ø 5: Metrics & DB (1-2 —á–∞—Å–∞)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- [ ] –°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –ë–î
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –≠—Ç–∞–ø 6: Testing (2-3 —á–∞—Å–∞)
- [ ] Unit —Ç–µ—Å—Ç—ã
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —ç—Ç–∞–ª–æ–Ω–æ–º –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –≠—Ç–∞–ø 7: Deploy (1 —á–∞—Å)
- [ ] Code review
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π rollout
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ò–¢–û–ì–û:** 12-18 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã

---

## üìû –ö–û–ù–¢–ê–ö–¢:

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–º. —ç—Ç–∞–ª–æ–Ω–Ω—ã–π —Ñ–∞–π–ª:
`/home/elcrypto/calk_wk/check_wr_final.py` (—Å—Ç—Ä–æ–∫–∏ 395-520)
